{"path": "./Audit_Reports_2024/Trail_of_Bits/2023-03-eclipse-mosquitto-securityreview.pdf", "project_info": {"url": "https://github.com/eclipse/mosquitto", "commit_hash": "9be6aec6cf4a229ffe26f809bdf73d1c22c3ae3b", "address": "N/A"}, "findings": [{"id": 0, "category": {"1": ["CWE-703"], "2": ["CWE-754"]}, "title": "Insufficient default number of PBKDF2 iterations", "description": "The default number of PBKDF2 iterations is significantly lower than current secure recommendations and provides little protection against offline brute-force attacks of Mosquitto password hashes.", "severity": "High", "contract": "N/A", "function": "N/A", "lineNumber": "36"}, {"id": 1, "category": {"1": ["CWE-697"]}, "title": "Improper implementation of constant-time comparison", "description": "Mosquitto implements two functions with the same body, memcmp_const and pw__memcmp_const, that are meant to compare two arrays (e.g., password hashes) in constant time but whose runtimes actually vary with the input data.", "severity": "Medium", "contract": "N/A", "function": "memcmp_const", "lineNumber": "37-44"}, {"id": 2, "category": {"1": ["CWE-284"]}, "title": "mosquitto_passwd creates world-readable password files", "description": "The mosquitto_passwd utility does not set a file mode creation mask to set secure file permissions when creating new password files or backups of existing ones, resulting in world-readable password files.", "severity": "High", "contract": "N/A", "function": "mosquitto_passwd", "lineNumber": "L100,L625"}, {"id": 3, "category": {"1": ["CWE-707"], "2": ["CWE-20"]}, "title": "mosquitto_passwd trusts existing backup files", "description": "The mosquitto_passwd utility does not ensure that a backup file with a predictable name does not already exist before opening it, allowing an attacker to create a file with the expected name and exfiltrate password file contents.", "severity": "High", "contract": "mosquitto_passwd", "function": "create_backup", "lineNumber": "L615-L629"}, {"id": 4, "category": {"1": ["CWE-707"], "2": ["CWE-170"]}, "title": "Heap buffer overread issue in persist__chunk_client_write_v6", "description": "Heap buffer overread issue was found in the persist__chunk_client_write_v6 function.", "severity": "Critical", "contract": "N/A", "function": "persist__chunk_client_write_v6", "lineNumber": "N/A"}, {"id": 5, "category": {"1": ["CWE-284"]}, "title": "mosquitto_ctrl dynsec init creates world-readable config", "description": "The mosquitto_ctrl utility's dynsec init command creates a world-readable Dynamic Security configuration file on Ubuntu 22.04, allowing an attacker to access its contents and brute-force the administrator password hash.", "severity": "Critical", "contract": "N/A", "function": "dynsec init", "lineNumber": "N/A"}, {"id": 6, "category": {"1": ["CWE-693"], "2": ["CWE-345"], "3": ["CWE-353"]}, "title": "Race condition in file existence check by mosquitto_ctrl dynsec init", "description": "The `dynsec` `init` subcommand of the `mosquitto_ctrl` utility has a time-of-check to time-of-use (TOCTOU) race condition when checking for file existence, allowing an attacker-controlled file to be created in the interval.", "severity": "High", "contract": "N/A", "function": "dynsec init", "lineNumber": "710-725"}, {"id": 7, "category": {"1": ["CWE-664"], "2": ["CWE-404"], "3": ["CWE-763"], "4": ["CWE-761"]}, "title": "Use-after-free instances in dynsec_groups__find and dynsec_clients__find", "description": "The Dynamic Security plugin attempts to free memory allocated for groups and clients when unloading configuration files, but dynsec_groups__find and dynsec_clients__find dereference already freed pointers to dynsec__group or dynsec__client structures.", "severity": "Critical", "contract": "N/A", "function": ["dynsec_groups__find", "dynsec_clients__find"], "lineNumber": ["78-86", "70:3, 81:17, 98:3"]}, {"id": 8, "category": {"1": ["CWE-703"], "2": ["CWE-754"], "3": ["CWE-252"], "4": ["CWE-690"]}, "title": "NULL pointer dereference in dynsec_roles__config_load", "description": "A NULL pointer dereference occurs in the dynsec_roles__config_load function.", "severity": "Critical", "contract": "N/A", "function": "dynsec_roles__config_load", "lineNumber": "N/A"}, {"id": 9, "category": {"1": ["CWE-284"]}, "title": "Broker creates world-readable TLS key log files", "description": "Mosquitto broker administrator uses the '--tls-keylog' argument to log TLS key material to a file, creating a world-readable key log file on Ubuntu 22.04, allowing an attacker to access the TLS key material and decrypt the recorded traffic.", "severity": "High", "contract": "N/A", "function": "N/A", "lineNumber": "N/A"}, {"id": 10, "category": {"1": ["CWE-693"], "2": ["CWE-345"], "3": ["CWE-346"], "4": ["CWE-940"]}, "title": "Broker trusts existing TLS key log files", "description": "The broker trusts existing TLS key log files without proper validation.", "severity": "Medium", "contract": "N/A", "function": "N/A", "lineNumber": "N/A"}, {"id": 11, "category": {"1": ["CWE-697"], "2": ["CWE-1025"], "3": ["CWE-595"], "4": ["CWE-597"]}, "title": "libmosquitto accepts wildcard certificates for public suffixes", "description": "libmosquitto's mosquitto__cmp_hostname_wildcard function compares a remote hostname against the domain name identifier in its TLS certificate, taking wildcards into account. As currently implemented, the function accepts identifiers of the form *.tld, where .tld may be a public suffix.", "severity": "Medium", "contract": "N/A", "function": "mosquitto__cmp_hostname_wildcard", "lineNumber": "N/A"}, {"id": 12, "category": {"1": ["CWE-707"], "2": ["CWE-20"]}, "title": "Username characters not validated when taken from client certificate", "description": "The Mosquitto broker does not validate username characters when determining the username from a client certificate using the `use_identity_as_username` or `use_subject_as_username` configuration options, allowing usernames to contain disallowed characters.", "severity": "Medium", "contract": "N/A", "function": "get_username_from_cert", "lineNumber": "N/A"}, {"id": 13, "category": {"1": ["CWE-707"], "2": ["CWE-20"]}, "title": "Improper parsing of X-Forwarded-For header", "description": "The Mosquitto broker does not properly parse the X-Forwarded-For header, allowing an attacker to spoof their IP address.", "severity": "High", "contract": "N/A", "function": "first_entry()", "lineNumber": "206-216"}, {"id": 14, "category": {"1": ["CWE-703"], "2": ["CWE-754"], "3": ["CWE-394"]}, "title": "Logger registers with DLT when DLT is not a log destination", "description": "Mosquitto does not verify that the user configured DLT for logging and instead confirms only that '/tmp/dlt' exists and is a named pipe, so unexpected behavior may occur if the file is controlled by an attacker.", "severity": "Informational", "contract": "N/A", "function": "dlt_fifo_check() and DLT_REGISTER_APP()", "lineNumber": "84-92,138-143"}]}